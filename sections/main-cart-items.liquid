<div class="cart-items bg-background py-12">
  <div class="max-w-container mx-auto px-4 lg:px-8">
    <h1 class="font-display font-bold text-3xl text-text mb-8">Your Cart</h1>
    
    {%- if cart == empty -%}
      <div class="empty-cart text-center py-20">
        <h2 class="font-display font-bold text-2xl text-text mb-4">Your cart is empty</h2>
        <p class="text-lg text-text opacity-80 mb-8">Add some products to get started!</p>
        <a href="{{ routes.all_products_collection_url }}" class="btn-primary">
          Continue Shopping
        </a>
      </div>
    {%- else -%}
      <form action="{{ routes.cart_url }}" method="post" novalidate class="cart">
        <div class="cart-items-wrapper">
          <div class="cart-item-headers grid grid-cols-1 lg:grid-cols-12 gap-4 pb-4 border-b border-border mb-6 hidden lg:grid">
            <div class="lg:col-span-6 font-semibold text-text">Product</div>
            <div class="lg:col-span-2 font-semibold text-text text-center">Price</div>
            <div class="lg:col-span-2 font-semibold text-text text-center">Quantity</div>
            <div class="lg:col-span-2 font-semibold text-text text-right">Total</div>
          </div>
          
          {%- for item in cart.items -%}
            <div class="cart-item grid grid-cols-1 lg:grid-cols-12 gap-4 py-6 border-b border-border" id="CartItem-{{ item.index | plus: 1 }}">
              {%- comment -%} Product Info {%- endcomment -%}
              <div class="lg:col-span-6 flex gap-4">
                {%- if item.image -%}
                  <div class="cart-item-image">
                    <img 
                      src="{{ item.image | image_url: width: 120 }}" 
                      alt="{{ item.image.alt | escape }}"
                      class="w-20 h-20 object-cover rounded-md"
                      loading="lazy"
                      width="80"
                      height="80"
                    >
                  </div>
                {%- endif -%}
                
                <div class="cart-item-details flex-1">
                  <h3 class="font-semibold text-text mb-1">
                    <a href="{{ item.product.url }}" class="hover:text-primary transition-colors">
                      {{ item.product.title }}
                    </a>
                  </h3>
                  {%- if item.product.has_only_default_variant == false -%}
                    <div class="cart-item-variants text-sm text-text opacity-70">
                      {%- for option in item.options_with_values -%}
                        {{ option.name }}: {{ option.value }}
                        {%- unless forloop.last -%}, {%- endunless -%}
                      {%- endfor -%}
                    </div>
                  {%- endif -%}
                  
                  {%- comment -%} Remove Button {%- endcomment -%}
                  <div class="mt-2">
                    <button 
                      type="submit" 
                      name="updates[]" 
                      value="0" 
                      class="text-sm text-primary hover:underline"
                      form="cart"
                    >
                      Remove
                    </button>
                  </div>
                </div>
              </div>
              
              {%- comment -%} Price {%- endcomment -%}
              <div class="lg:col-span-2 flex items-center justify-center">
                <div class="price text-text">
                  {%- if item.original_price != item.final_price -%}
                    <span class="line-through text-text opacity-50">{{ item.original_price | money }}</span>
                    <span class="font-semibold text-primary">{{ item.final_price | money }}</span>
                  {%- else -%}
                    <span class="font-semibold">{{ item.price | money }}</span>
                  {%- endif -%}
                </div>
              </div>
              
              {%- comment -%} Quantity {%- endcomment -%}
              <div class="lg:col-span-2 flex items-center justify-center">
                <div class="quantity-input flex items-center border border-border rounded-sloe w-fit">
                  <button
                    type="button"
                    class="quantity-button px-3 py-2 text-text hover:bg-accent transition-colors"
                    onclick="updateCartQuantity({{ item.index | plus: 1 }}, -1)"
                  >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                    </svg>
                  </button>
                  <input
                    type="number"
                    name="updates[]"
                    value="{{ item.quantity }}"
                    min="0"
                    class="quantity-input-field w-16 text-center border-0 outline-none"
                    id="updates_{{ item.key }}"
                    onchange="updateCartItem(this)"
                  >
                  <button
                    type="button"
                    class="quantity-button px-3 py-2 text-text hover:bg-accent transition-colors"
                    onclick="updateCartQuantity({{ item.index | plus: 1 }}, 1)"
                  >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                  </button>
                </div>
              </div>
              
              {%- comment -%} Total {%- endcomment -%}
              <div class="lg:col-span-2 flex items-center justify-end">
                <div class="item-total font-bold text-lg text-primary">
                  {{ item.final_line_price | money }}
                </div>
              </div>
            </div>
          {%- endfor -%}
        </div>
      </form>
    {%- endif -%}
  </div>
</div>

<script>
  function updateCartQuantity(line, change) {
    const input = document.querySelector(`input[name="updates[]"]:nth-of-type(${line})`);
    const currentValue = parseInt(input.value);
    const newValue = Math.max(0, currentValue + change);
    input.value = newValue;
    updateCartItem(input);
  }

  function updateCartItem(input) {
    fetch('/cart/change.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        line: Array.from(input.parentElement.parentElement.parentElement.parentElement.children).indexOf(input.parentElement.parentElement.parentElement) + 1,
        quantity: parseInt(input.value)
      })
    })
    .then(response => response.json())
    .then(data => {
      location.reload();
    })
    .catch(error => {
      console.error('Error:', error);
    });
  }
</script>

{% schema %}
{
  "name": "Cart items",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": false
    }
  ]
}
{% endschema %}