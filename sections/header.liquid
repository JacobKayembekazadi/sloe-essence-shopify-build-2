{{ 'section-header.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign navigation = section.settings.menu
-%}

<header class="header sticky top-0 bg-background/80 backdrop-blur-md border-b border-border z-50">
  <nav class="max-w-container mx-auto flex justify-between items-center py-5 px-4 lg:px-8">
    {%- comment -%} Logo {%- endcomment -%}
    <div class="header__logo">
      {%- if section.settings.logo != blank -%}
        <a href="{{ routes.root_url }}" class="header__logo-link">
          <img
            src="{{ section.settings.logo | image_url: width: section.settings.logo_width }}"
            alt="{{ shop.name }}"
            loading="lazy"
            class="header__logo-image"
            width="{{ section.settings.logo_width }}"
            height="{{ section.settings.logo | image_url: width: section.settings.logo_width | image_tag: '' | split: 'height="' | last | split: '"' | first }}"
          >
        </a>
      {%- else -%}
        <a href="{{ routes.root_url }}" class="header__logo-text font-display font-bold text-2xl text-text">
          {{ shop.name }}
        </a>
      {%- endif -%}
    </div>

    {%- comment -%} Desktop Navigation {%- endcomment -%}
    {%- if navigation != blank -%}
      <nav class="header__navigation hidden md:flex gap-8">
        {%- for link in navigation.links -%}
          <a
            href="{{ link.url }}"
            class="text-lg font-medium text-text hover:text-primary transition-colors"
            {% if link.current %}aria-current="page"{% endif %}
          >
            {{ link.title }}
          </a>
        {%- endfor -%}
      </nav>
    {%- endif -%}

    {%- comment -%} Header Icons {%- endcomment -%}
    <div class="header__icons flex items-center gap-4">
      {%- if shop.customer_accounts_enabled -%}
        <a
          href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
          class="header__icon hover:opacity-70 transition-opacity"
          aria-label="{%- if customer -%}Account{%- else -%}Log in{%- endif -%}"
        >
          {% render 'icon-account' %}
        </a>
      {%- endif -%}

      <a href="{{ routes.cart_url }}" class="header__icon header__cart hover:opacity-70 transition-opacity" id="cart-icon-bubble">
        {% render 'icon-cart' %}
        <span class="visually-hidden">{{ 'templates.cart.cart' | t }}</span>
        {%- if cart != empty -%}
          <div class="cart-count-bubble">
            {%- if cart.item_count < 100 -%}
              <span aria-hidden="true">{{ cart.item_count }}</span>
            {%- endif -%}
            <span class="visually-hidden">{{ 'sections.header.cart_count' | t: count: cart.item_count }}</span>
          </div>
        {%- endif -%}
      </a>

      <button
        type="button"
        class="header__icon header__menu-toggle md:hidden"
        aria-controls="HeaderMenu"
        aria-expanded="false"
        aria-label="{{ 'general.accessibility.menu' | t }}"
        onclick="toggleMobileMenu()"
      >
        {% render 'icon-hamburger' %}
      </button>
    </div>
  </nav>

  {%- comment -%} Mobile Menu {%- endcomment -%}
  <div id="HeaderMenu" class="header__mobile-menu md:hidden bg-background border-t border-border hidden">
    <div class="flex flex-col space-y-4 p-4">
      {%- if navigation != blank -%}
        {%- for link in navigation.links -%}
          <a
            href="{{ link.url }}"
            class="block py-2 text-lg font-medium text-text hover:text-primary transition-colors"
            {% if link.current %}aria-current="page"{% endif %}
          >
            {{ link.title }}
          </a>
        {%- endfor -%}
      {%- endif -%}
    </div>
  </div>
</header>

<style>
  .header__logo-text {
    text-decoration: none;
  }
  
  .header__logo-image {
    max-height: 50px;
    width: auto;
  }

  .cart-count-bubble {
    position: absolute;
    top: -8px;
    right: -8px;
    background: var(--color-primary);
    color: white;
    border-radius: 50%;
    min-width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: bold;
  }

  .header__icon {
    position: relative;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    color: var(--color-text);
  }

  .header__cart svg,
  .header__icon svg {
    width: 24px;
    height: 24px;
    stroke: currentColor;
    fill: none;
    stroke-width: 2;
  }
</style>

<script>
  function toggleMobileMenu() {
    const menu = document.getElementById('HeaderMenu');
    const isOpen = menu.classList.contains('hidden');
    
    if (isOpen) {
      menu.classList.remove('hidden');
      document.querySelector('.header__menu-toggle').setAttribute('aria-expanded', 'true');
    } else {
      menu.classList.add('hidden');
      document.querySelector('.header__menu-toggle').setAttribute('aria-expanded', 'false');
    }
  }
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 250,
      "step": 10,
      "default": 100,
      "unit": "px",
      "label": "Logo width"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu"
    }
  ]
}
{% endschema %}